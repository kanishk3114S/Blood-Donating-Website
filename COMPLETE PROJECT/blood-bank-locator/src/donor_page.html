<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Blood Donation - Donor Form</title>
<style>
body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background: linear-gradient(120deg,#ffeaea 60%,#fffaf6);
  margin: 0;
  min-height: 100vh;
}
.container {
  max-width: 460px;
  margin: 40px auto 0 auto;
  background: #fff;
  box-shadow: 0 4px 18px rgba(180,85,85,0.18);
  border-radius: 13px;
  padding: 20px 20px 15px 20px; /* reduced padding inside container for tighter look */
}
h2 {
  font-weight: 700;
  margin: 0 0 14px 0; /* less space below heading */
  text-align: center;
  color: #d32f2f;
  letter-spacing: 0.5px;
}
.form-group, fieldset {
  margin-bottom: 5px; /* tight spacing between all form groups and fieldsets */
}
label {
  display: block;
  margin-bottom: 2px; /* reduced space below labels */
  font-weight: 500;
  color: #b71c1c;
  letter-spacing: 0.2px;
}
input[type="text"],
input[type="number"],
input[type="date"],
select {
  width: 100%;
  padding: 5px 6px; /* reduced padding inside inputs */
  margin-bottom: 0;
  font-size: 1rem;
  border: 1.5px solid #ccc;
  border-radius: 5px;
  background: #faf7f7;
  transition: border 0.2s, box-shadow 0.2s;
}
input[type="text"]:focus,
input[type="number"]:focus,
input[type="date"]:focus,
select:focus {
  border-color: #e57373;
  box-shadow: 0 0 4px #ffcdd2;
  outline: none;
}
input[type="checkbox"] {
  margin-right: 4px;
  accent-color: #d32f2f;
  transform: scale(1.1); /* slightly smaller checkboxes for tightness */
  vertical-align: middle;
}
fieldset {
  border: 1.2px solid #d1bcbc;
  border-radius: 8px;
  padding: 6px 8px 4px 8px; /* reduced padding within fieldsets */
  background: #fff7f7;
  margin-bottom: 5px; /* less margin below fieldset */
}
legend {
  color: #b71c1c;
  font-weight: 600;
  font-size: 1.02em;
  padding: 0 8px;
}
.form-group p {
  font-size: 0.9em;
  color: #c62828;
  margin-top: 2px;
  margin-bottom: 0;
  font-weight: 500;
}
button[type="submit"] {
  width: 100%;
  background: #e53935;
  color: #fff;
  padding: 7px 0; /* less padding for a compact button */
  border: none;
  border-radius: 5px;
  font-size: 1.07em;
  font-weight: 600;
  letter-spacing: 0.2px;
  margin-top: 5px;
  cursor: pointer;
  transition: background 0.2s, box-shadow 0.2s;
}
button[type="submit"]:hover {
  background: #b71c1c;
  box-shadow: 0 2px 9px #ffeaea;
}
@media (max-width: 550px) {
  .container {
    padding: 8px 3px;
  }
}
</style>


<!-- Firebase authentication Connection -->
 
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAJomkPgl3xozuFw2_69LE3NCCb7rZYevw",
    authDomain: "blood-hero-ed188.firebaseapp.com",
    projectId: "blood-hero-ed188",
    storageBucket: "blood-hero-ed188.firebasestorage.app",
    messagingSenderId: "806006453200",
    appId: "1:806006453200:web:b72ebd8130b6ee1d1a3fd5",
    measurementId: "G-B2K41K2JX4"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>

</head>
<body>
  <div class="container">
    <h2>Donor Registration</h2>
    <form id="donorForm">
      <!-- Existing fields -->
      <div class="form-group">
        <label>Name:</label>
        <input required id="name" type="text">
      </div>
      <div class="form-group">
        <label>Blood Type:</label>
        <select required id="bloodType">
          <option value="">Select</option>
          <option>A+</option><option>A-</option>
          <option>B+</option><option>B-</option>
          <option>AB+</option><option>AB-</option>
          <option>O+</option><option>O-</option>
        </select>
      </div>
      <div class="form-group">
        <label>Location (City or Area):</label>
        <input required id="location" type="text" placeholder="e.g. Guwahati">
      </div>

      <!-- New fields -->
      <div class="form-group">
        <label>Age:</label>
        <input required id="age" type="number" min="1" max="120" placeholder="Enter your age">
      </div>

      <div class="form-group">
        <label>Gender:</label>
        <select required id="gender">
          <option value="">Select</option>
          <option>Male</option>
          <option>Female</option>
          <option>Other</option>
          <option>Prefer not to say</option>
        </select>
      </div>

      <div class="form-group">
        <label>Have you donated blood before?</label>
        <select required id="donationHistory">
          <option value="">Select</option>
          <option value="yes">Yes</option>
          <option value="no">No</option>
        </select>
      </div>

      <div class="form-group" id="lastDonationDiv" style="display:none;">
        <label>When was your last donation?</label>
        <input id="lastDonation" type="date" max="">
      </div>

      <fieldset style="margin-bottom: 15px; border: 1px solid #c0c0c0; padding: 10px; border-radius:4px;">
        <legend style="font-weight:bold; padding:0 5px;">Health and Eligibility Questions</legend>

        <div class="form-group">
          <label>Are you feeling well today?</label>
          <input type="checkbox" id="feelingWellYes" name="feelingWell" value="yes" onclick="checkEligibility('well', false)"> Yes
          <input type="checkbox" id="feelingWellNo" name="feelingWell" value="no" onclick="checkEligibility('well', true)"> No
          <p id="wellMsg" style="color: red; margin-top:5px; display:none;">
            Sorry you are not eligible for donating blood as you are not well.
          </p>
        </div>

        <div class="form-group">
          <label>Have you eaten in last 4 hours?</label>
          <input type="checkbox" id="eatenRecentlyYes" name="eatenRecently" value="yes" onclick="checkEligibility('eat', false)"> Yes
          <input type="checkbox" id="eatenRecentlyNo" name="eatenRecently" value="no" onclick="checkEligibility('eat', true)"> No
          <p id="eatMsg" style="color: red; margin-top:5px; display:none;">
            Sorry you are not eligible for donating blood as you have not eaten in last 4 hours.
          </p>
        </div>

        <div class="form-group">
          <label>Are you currently pregnant or breastfeeding?</label>
          <input type="checkbox" id="pregnantOrBreastfeedingYes" name="pregnantOrBreastfeeding" value="yes" onclick="checkEligibility('preg', true)"> Yes
          <input type="checkbox" id="pregnantOrBreastfeedingNo" name="pregnantOrBreastfeeding" value="no" onclick="checkEligibility('preg', false)"> No
          <p id="pregMsg" style="color: red; margin-top:5px; display:none;">
            Sorry you are not eligible for donating blood as you currently pregnant or breastfeeding.
          </p>
        </div>

        <div class="form-group">
          <label>Have you had any recent illnesses or infections?</label>
          <input type="checkbox" id="noRecentIllnessYes" name="noRecentIllness" value="yes" onclick="checkEligibility('illness', true)"> Yes
          <input type="checkbox" id="noRecentIllnessNo" name="noRecentIllness" value="no" onclick="checkEligibility('illness', false)"> No
          <p id="illnessMsg" style="color: red; margin-top:5px; display:none;">
            Sorry you are not eligible for donating blood as you have had recent illnesses or infections.
          </p>
        </div>

        <div class="form-group">
          <label>Do you have any chronic medical conditions? (like heart disease, anemia)</label>
          <input type="checkbox" id="noChronicCondYes" name="noChronicCond" value="yes" onclick="checkEligibility('chronic', true)"> Yes
          <input type="checkbox" id="noChronicCondNo" name="noChronicCond" value="no" onclick="checkEligibility('chronic', false)"> No
          <p id="chronicMsg" style="color: red; margin-top:5px; display:none;">
            Sorry you are not eligible for donating blood as you have chronic medical conditions.
          </p>
        </div>

      </fieldset>

      <div class="form-group">
        <label>Weight (kg):</label>
        <input required id="weight" type="number" min="30" max="200" placeholder="e.g. 65">
      </div>

      <div class="form-group">
        <label>Height (cm):</label>
        <input required id="height" type="number" min="100" max="250" placeholder="e.g. 170">
      </div>

      <!-- Existing button unchanged -->
      <button type="submit">Find Blood Banks</button>
    </form>
  </div>

  <script>
    // Show/hide last donation date input depending on donation history
    const donationHistory = document.getElementById('donationHistory');
    const lastDonationDiv = document.getElementById('lastDonationDiv');
    const lastDonationInput = document.getElementById('lastDonation');

    // Set max date for last donation as today
    lastDonationInput.max = new Date().toISOString().split('T')[0];

    donationHistory.addEventListener('change', () => {
      lastDonationDiv.style.display = donationHistory.value === 'yes' ? 'block' : 'none';
      if (donationHistory.value !== 'yes') {
        lastDonationInput.value = '';
      }
    });

    function checkEligibility(question, showMsg) {
      // Ensure mutual exclusivity for each question's checkboxes
      switch(question) {
        case 'well':
          if(showMsg) {
            document.getElementById('feelingWellYes').checked = false;
          } else {
            document.getElementById('feelingWellNo').checked = false;
          }
          document.getElementById('wellMsg').style.display = showMsg ? 'block' : 'none';
          break;
        case 'eat':
          if(showMsg) {
            document.getElementById('eatenRecentlyYes').checked = false;
          } else {
            document.getElementById('eatenRecentlyNo').checked = false;
          }
          document.getElementById('eatMsg').style.display = showMsg ? 'block' : 'none';
          break;
        case 'preg':
          if(showMsg) {
            document.getElementById('pregnantOrBreastfeedingNo').checked = false;
          } else {
            document.getElementById('pregnantOrBreastfeedingYes').checked = false;
          }
          document.getElementById('pregMsg').style.display = showMsg ? 'block' : 'none';
          break;
        case 'illness':
          if(showMsg) {
            document.getElementById('noRecentIllnessNo').checked = false;
          } else {
            document.getElementById('noRecentIllnessYes').checked = false;
          }
          document.getElementById('illnessMsg').style.display = showMsg ? 'block' : 'none';
          break;
        case 'chronic':
          if(showMsg) {
            document.getElementById('noChronicCondNo').checked = false;
          } else {
            document.getElementById('noChronicCondYes').checked = false;
          }
          document.getElementById('chronicMsg').style.display = showMsg ? 'block' : 'none';
          break;
      }
    }

    document.getElementById('donorForm').onsubmit = function(e) {
      e.preventDefault();

      // Age validation (cannot donate if under 18)
      const age = parseInt(document.getElementById('age').value, 10);
      if (age < 18) {
        alert("Sorry, you must be at least 18 years old to donate blood.");
        return;
      }

      // Additional validations can be added here as needed

      // Collect the form data
      const formData = {
        name: document.getElementById('name').value,
        bloodType: document.getElementById('bloodType').value,
        location: document.getElementById('location').value,
        age: age,
        gender: document.getElementById('gender').value,
        donationHistory: document.getElementById('donationHistory').value,
        lastDonation: document.getElementById('lastDonation').value,
        feelingWellYes: document.getElementById('feelingWellYes').checked,
        feelingWellNo: document.getElementById('feelingWellNo').checked,
        eatenRecentlyYes: document.getElementById('eatenRecentlyYes').checked,
        eatenRecentlyNo: document.getElementById('eatenRecentlyNo').checked,
        pregnantOrBreastfeedingYes: document.getElementById('pregnantOrBreastfeedingYes').checked,
        pregnantOrBreastfeedingNo: document.getElementById('pregnantOrBreastfeedingNo').checked,
        noRecentIllnessYes: document.getElementById('noRecentIllnessYes').checked,
        noRecentIllnessNo: document.getElementById('noRecentIllnessNo').checked,
        noChronicCondYes: document.getElementById('noChronicCondYes').checked,
        noChronicCondNo: document.getElementById('noChronicCondNo').checked,
        weight: document.getElementById('weight').value,
        height: document.getElementById('height').value,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      };

      // Save form data to Firestore in "donor" collection
      firebase.firestore().collection('donor').add(formData)
        .then(() => {
          // Redirect as per original code after successful save
          const bloodTypeEncoded = encodeURIComponent(formData.bloodType);
          const locationEncoded = encodeURIComponent(formData.location);
          window.location.href = `result_donor.html?type=donor&bloodType=${bloodTypeEncoded}&location=${locationEncoded}`;
        })
        .catch(error => {
          alert('Error saving donor data: ' + error.message);
        });
    };
  </script>
</body>
</html>
